## Code Review

--------------

### Все говорят об этом, но есть он не у всех

Процесс, который входит в 10 моих любимых деятельностей на работе – это код ревью проекта. 
Этот процесс заставляет учиться у другого и учить других. 
Особенно интересно этот процесс развивается в учебных командах или командах, которые собраны недавно, 
когда вы ещё полны энтузиазма и процессы новы и ещё на стадии отладки.

Хочется заметить, что данное описание код ревью сделано для обзора кода в рабочей среде Data Scientist / Analysts / Engineer (DS|DA), то есть имеют большое отличие от классического процесса для программистов.

`Во-первых`, DS|DA не программисты, что уже давно было замечено в их особом версионировании моделей и результатов (но хорошо, что версионирование уже решается с помощью [DVC](https://dvc.org/) и его аналогов).

`Во-вторых`, объём кода в процессе разработки модели невелк, а в написании ETL процесса, часто много “домашних заготовок”, которые у DS|DA выработаны годами.

Это означате, что стандартное количество строк до 400 за 1 раз (**_смотри рисунок внимателености ревьюэра, где LOC - количество строк, defects - количество найденных недочетов / ошибок_**), может быть намного меньше, но ошибок надлать можно больше. Например, перепуть количество деревьев, глубину и т.д. в конфиках алгоритма

<p align="center"> 
<img src="https://github.com/NameArtem/tutorials_and_presentations/blob/master/codeReview/code-review-best-practices-figure-01.gif?style=centerme"
     alt="LOC"
     style="align: center;" />
</p>

`В-третьих`, разработка модели или обработка данных для неё, это творческий процесс, где DS|DA сосредоточен на получении результатов, а не качестве кода.

Хороший и правильный процесс обзора и утверждения кода необходим!
Из плюсов процесса можно выделить (мне лично нравятся):

• процесс не является “наказательным”, это процесс передачи опыта (учебный процесс). 
То есть, если вы хотите преемственности и развития своих сотрудников, то процесс позволяет наладить “код-университет”;

• процесс может быть представлен в виде внутрикомандного мероприятия или использован для развития командного духа (из этого плюса была выделен интересная особенность - история проекта, т.е. процесс, когда DS|DA, перед отправкой кода на ревью, создает историю деятельности, что позволяет его лидеру команды получить информацию о понимании проекта разработчиком);

• процесс увеличивает ответственность за свою работу;

• процесс увеличивает “узнаваемость” и “переиспользуемость” кода, то есть о ваших решениях будут знать больше людей 

Код ревью – бывает 3 разных вариантов (вы можете придумать себе ещё):

• индивидуальный ревью кода коллег (именно это будет описано далее);

• парный ревью, который делает ревьюэр и коллега, чей код проверяют (метод, который подходит для пар senior – junior/inter, team lead - team);

• ревью – рассказанная история – процесс ревью, когда ревьюэр уже знаком с кодом, но многие решения были не понятны. Тогда создатель кода представляет все решения в виде истории (при возможности с проекцией на бизнес - задачу). 

-------------

### С чего начать? Давайте разберем процесс и рассмотрим каждый шаг:

#### 1 Мой ToDo

В проекте должен быть **«пост»ToDo** файл с прописанными шагами и простым описанием каждого файла и каталога, который поддерживает данный разработчик. В файле заполняются шаги, что и для чего сделано.

Но! Ревьюэр должен иметь такой же файл для своей работы, в виде комментариев для себя. В ревьюэр _ToDo_ хорошо описывать последовательность ревью и что и когда смотреть.

**Свой пример**: в результате отработки таких ToDo'шек, на данный момент, я составляю сгруппированный список из нескольких больших элементов, которые содержат 2 – 3 маленькие подзадачи. 

Наличие списка для поиска - это конечный список дел, который становится маршрутом по коду вашего коллеги, это лучше, чем бездумно гулять по ветвлениям чужого кода.

```ToDo
### Code Review ToDo (by Seleznev)
// file | task | additional
1. job_runner.py | проверить набор функций по работе с витриной | -> TEST 1, 2
2. config.json   | добавленн новый файл конфигурации, проверить наличие ключей | -> TEST 3, 4
…et

### TEST
// main job | wh? | additional
1. step 1 | тестирование на hql | -
2. step 1 | проверить правильность коннектера к данным
3. step 2 | проверить правильность работы с json в файлах
4. step 2 | подходит ли json, почему не yaml или др.форматы | уточнить у архитектора
…et
```

#### 2 Шаблоны замечаний

Стоит заранее подготовить шаблонные фразы для тех мест, где код может быть улучшен. Сделать это стоит заранее и приготовить 2 – 3 фразы, которые будут описывать код, дадут старт к рассуждениям и укажут на недостаток. 

**Свой пример**: у меня есть фразs, начинающаяся со слов «**_Что есть исправить…_**»; или если вариантов решения много, а точного улучшения не ожидается «**_Тут возможны варианты улучшения, давайте поразмышляем о …_**»

**Особенность**: при дальнейшей работе с замечаниям по коду, стоит выбирать решение, которое основывается на меньшем количестве предположений, то есть самое просто (можно ознакомиться с принципом «__Бритва Оккама__» и попробовать проецировать его на код)

#### 3 Договоритесь о форматировании кода

Работать с кодом будет удобней, если будет единый стиль форматирования и он будет одинаков (_максимально похож_) для всех используемых языков. В этом пункте DS | DA повезло больше всех, так как их языковой инструментарий (Python, R, Scala) позволяет выработать универсальный стиль.

В этот пункт включаем и найминг перемененных:
• либо везде второе слово с большой: `_theVariable_`
• либо верблюжий: `_TheVariable_`
• либо змеиный: `_the_variable_`
и т.д.

**Стиль комментирования**:

Договоримся о комментировании: выделите обязательные места, где должны быть комментарии. `Самые популярные места`: начало класса, начало функции, перед большой обработкой значений, перед визуализацией.
Как ни странно, но лучше договорится о варианте комментирования: _строчные_ (`#`, `//`, `--`) или _многострочные_ (`/**/`) оформления комментариев (**_я выбираю многострочные_**) 

**Важно запомнить**, что комментарии должны включать в себя информацию которая описывает не только «что вы делаете», но и почему вы это делаете. Часть «что вы делаете» должна пересекаться с ToDo

#### 4 Вспомните алгоритмы

Не забываем о алгоритмах, которые можно использовать (**_в библиотеке вашей команды должны появится книги: Тим Рафгарден: Совершенный алгоритм | Кормена. Лейзерсона. Ривеста.: Алгоритм - построение и анализ_**)

**Пример**: если вы знаете, что работаете с числовыми значения, на входе у вас всегда список из int / float, а на выходе обработанные значения из этого списка, которые больше чем n. А ваш коллега решил искать значения через цикл, то исправьте это.

```Python
"""
   Вы увидели кода, где
   valueList - всегда список числовых значений
   trigger - float значение, если значние в valueList больше или равно trigger, совершается действие
"""
# Было
for i in valueList:
     if i >= trigger:
          # action

# Что если огранить список зарание и отсортировать его. 
# Мы уменьшем количество опираций в цикле for

# Будет
valueList = sorted(valueList, key=lambda x: x >= trigger)
# action
```


#### 5 Не повторяемость кода (DRY code – do not repeat yourself)

Если код, который вы видите повторяется 2 и более раза. Напишите комментарий, что эту часть надо убрать и сделать функцией или компонентом.
Невозможно сделать функцией? Переосмыслите этот отрезок кода.


«код пример на sql – с with»

#### 6 Лимит глубины условий

DS | DA играясь с условиями и циклами в Python могут уходить довольно глубоко, но конечный результат может не быть доступен. Стоит в своем код стайле описать глубину возможного (я практикую не более 3, если надо больше условий – то нужен другой подход, а если это цикл, то не больше 2 (что уже много!) )

№ Лимитированная длинна условий
-
	-
		-
		!

#### 7 Файл конфигурации

В проектах DS | DA часто используются конфигурации, настройки и прочее. Не стоит их повторять в коде, используйте для этого конфигурационные файл в json или yaml форматах, обращаясь к ним.
Это удобно и позволяет версионировать код и результаты эксперимента.





#### 8 Список рекомендаций

Запомним: Не смотря на любые призывы, люди не любят или боятся заниматься критикой коллег, особенно если этот коллега HiPP (высоко оплачиваемая персона, звезда компании и т.д.). Сгладить этот процесс поможет составление списка в комментариях к коду, до и после ревью: главные 5 вещей, которые стоит сделать в следующий раз и 5 вещей, которые не стоит использовать в проекте (по причинам).

Происходит выравнивание негатива позитивными решениям.

